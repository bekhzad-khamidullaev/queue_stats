<!doctype html>
<html lang="ru" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Queue Stats{% endblock %}</title>
    <script>
      (function () {
        try {
          var savedTheme = localStorage.getItem('ui-theme');
          if (savedTheme === 'light' || savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', savedTheme);
          }
        } catch (e) {
          // Ignore storage errors and keep default theme.
        }
      })();
    </script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/ws.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link rel="stylesheet" href="/static/css/tailwind.css" />
    <link rel="stylesheet" href="/static/css/app.css" />
    <script src="/static/js/charts.js" defer></script>
    <script src="/static/js/select2-init.js" defer></script>
    <script src="/static/js/theme-toggle.js" defer></script>
    <script>
      function syncTableRowCaptions() {
        document.querySelectorAll(".radix-table").forEach(function (table) {
          if (table.dataset.autoCounter === "off") return;
          var tbody = table.tBodies && table.tBodies[0];
          if (!tbody) return;
          var dataRows = 0;
          Array.prototype.forEach.call(tbody.rows, function (row) {
            var firstCell = row.cells && row.cells[0];
            if (!firstCell || firstCell.colSpan < 2) dataRows += 1;
          });
          var caption = table.caption;
          if (!caption || caption.dataset.autoCounter !== "on") {
            caption = document.createElement("caption");
            caption.dataset.autoCounter = "on";
            table.insertBefore(caption, table.firstChild);
          }
          caption.textContent = "Строк: " + dataRows;
        });
      }

      document.addEventListener("DOMContentLoaded", syncTableRowCaptions);
      document.addEventListener("htmx:afterSwap", syncTableRowCaptions);
      document.addEventListener("htmx:afterSettle", syncTableRowCaptions);
    </script>
  </head>
  <body class="radix-body">
    {% if request.user.is_authenticated %}
    <header class="border-b border-slate-800 bg-slate-950/70 backdrop-blur">
      <div class="max-w-7xl mx-auto px-4 py-3 flex flex-wrap gap-2 items-center justify-between">
        <nav class="flex flex-wrap gap-2">
          <a href="{% url 'home' %}" class="radix-button-secondary">{% tr "Главная" %}</a>
          <a href="{% url 'report-summary-page' %}" class="radix-button-secondary">Summary</a>
          <a href="{% url 'report-answered-page' %}" class="radix-button-secondary">Answered</a>
          <a href="{% url 'report-unanswered-page' %}" class="radix-button-secondary">Unanswered</a>
          <a href="{% url 'report-cdr-page' %}" class="radix-button-secondary">CDR</a>
          <a href="{% url 'dashboards-page' %}" class="radix-button-secondary">Dashboards</a>
          <a href="{% url 'analytics-page' %}" class="radix-button-secondary">Analytics</a>
          <a href="{% url 'payouts-page' %}" class="radix-button-secondary">{% tr "Выплаты" %}</a>
          <a href="{% url 'realtime-page' %}" class="radix-button-secondary">Realtime</a>
          {% if request.user.role == 'admin' %}<a href="{% url 'settings-page' %}" class="radix-button-secondary">Settings</a>{% endif %}
        </nav>
        <a href="{% url 'web-logout' %}" class="radix-button">{% tr "Выйти" %}</a>
      </div>
    </header>
    {% endif %}

    <main class="max-w-7xl mx-auto p-4">{% block body %}{% endblock %}</main>
  </body>
</html>
