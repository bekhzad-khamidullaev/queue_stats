{% extends "stats/base.html" %}
{% block title %}Дашборд | Queue Stats{% endblock %}
{% block body %}
<header class="border-b border-slate-800 bg-slate-950/70 backdrop-blur">
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
    <div>
      <h1 class="text-xl font-semibold text-slate-100">Queue Stats Monolith</h1>
      <p class="text-xs text-slate-400">Django templates + HTMX + WebSocket + AMI</p>
    </div>
    <a href="{% url 'web-logout' %}" class="radix-button-secondary">Выйти</a>
  </div>
</header>

<main class="max-w-7xl mx-auto p-4 space-y-4">
  <section class="radix-card p-4">
    <form class="grid grid-cols-1 md:grid-cols-4 gap-3" id="report-filters" method="get">
      <label class="block">
        <span class="text-sm text-slate-300">Начало</span>
        <input name="start" value="{{ default_start }}" class="radix-input mt-1" />
      </label>
      <label class="block">
        <span class="text-sm text-slate-300">Конец</span>
        <input name="end" value="{{ default_end }}" class="radix-input mt-1" />
      </label>
      <label class="block md:col-span-2">
        <span class="text-sm text-slate-300">Очереди (через запятую)</span>
        <input name="queues" placeholder="support,sales" class="radix-input mt-1" />
      </label>

      <div class="md:col-span-4 flex flex-wrap gap-2 mt-2">
        <button
          type="button"
          class="radix-button"
          hx-get="{% url 'ui-summary-partial' %}"
          hx-include="#report-filters"
          hx-target="#summary-report"
          hx-swap="innerHTML"
        >Summary</button>
        <button
          type="button"
          class="radix-button"
          hx-get="{% url 'ui-answered-partial' %}"
          hx-include="#report-filters"
          hx-target="#answered-report"
          hx-swap="innerHTML"
        >Answered</button>
        <button
          type="button"
          class="radix-button"
          hx-get="{% url 'ui-unanswered-partial' %}"
          hx-include="#report-filters"
          hx-target="#unanswered-report"
          hx-swap="innerHTML"
        >Unanswered</button>
        <button
          type="button"
          class="radix-button-secondary"
          hx-get="{% url 'ui-cdr-partial' %}"
          hx-include="#report-filters"
          hx-target="#cdr-report"
          hx-swap="innerHTML"
        >CDR</button>
      </div>

      <div class="md:col-span-4 flex flex-wrap gap-2 mt-2">
        <button class="radix-button-secondary" formaction="{% url 'ui-export-answered-xlsx' %}">Answered XLSX</button>
        <button class="radix-button-secondary" formaction="{% url 'ui-export-answered-pdf' %}">Answered PDF</button>
        <button class="radix-button-secondary" formaction="{% url 'ui-export-unanswered-xlsx' %}">Unanswered XLSX</button>
        <button class="radix-button-secondary" formaction="{% url 'ui-export-unanswered-pdf' %}">Unanswered PDF</button>
        <button class="radix-button-secondary" formaction="{% url 'ui-export-cdr-xlsx' %}">CDR XLSX</button>
        <button class="radix-button-secondary" formaction="{% url 'ui-export-cdr-pdf' %}">CDR PDF</button>
      </div>
    </form>
  </section>

  <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <div id="queue-summary-panel" class="radix-card p-4">
      {% include "stats/partials/realtime_queue_summary.html" %}
    </div>
    <div id="active-calls-panel" class="radix-card p-4">
      {% include "stats/partials/realtime_active_calls.html" %}
    </div>
  </section>

  <section class="radix-card p-4">
    <h2 class="text-lg font-semibold text-slate-100 mb-3">Summary</h2>
    <div id="summary-report" class="text-sm text-slate-400">Нажмите Summary для загрузки.</div>
  </section>

  <section class="radix-card p-4">
    <h2 class="text-lg font-semibold text-slate-100 mb-3">Answered Report</h2>
    <div id="answered-report" class="text-sm text-slate-400">Нажмите Answered для загрузки.</div>
  </section>

  <section class="radix-card p-4">
    <h2 class="text-lg font-semibold text-slate-100 mb-3">Unanswered Report</h2>
    <div id="unanswered-report" class="text-sm text-slate-400">Нажмите Unanswered для загрузки.</div>
  </section>

  <section class="radix-card p-4">
    <h2 class="text-lg font-semibold text-slate-100 mb-3">CDR Report</h2>
    <div id="cdr-report" class="text-sm text-slate-400">Нажмите CDR для загрузки.</div>
  </section>

  <div hx-ext="ws" ws-connect="/ws/htmx-realtime/" class="hidden"></div>
</main>
{% endblock %}
